<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Detalhe do edital</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 id="titulo">Edital</h1>
      <a class="btn" href="./">‚Üê Voltar</a>
    </div>

    <div id="blocos"></div>
    <div id="linkOficial" class="link-oficial"></div>
  </div>

  <script>
  async function main(){
    const params = new URLSearchParams(location.search);
    const slug = params.get('slug');

    const data = await (await fetch('data/editais.json',{cache:'no-store'})).json();
    const item = data.find(x=>x.slug===slug);

    if(!item){
      document.getElementById('titulo').textContent = 'Edital n√£o encontrado';
      return;
    }

    document.getElementById('titulo').textContent =
      `Edital: ${item.display_title || item.nome}`;

    const blocos = document.getElementById('blocos');

    // monta lista de se√ß√µes (compat: se n√£o houver, usa 'dados' como 1 se√ß√£o)
    const secoes = Array.isArray(item.secoes) && item.secoes.length
      ? item.secoes
      : (item.dados && item.dados.length ? [{ titulo: 'Resumo do edital', linhas: item.dados }] : []);

    if(!secoes.length){
      blocos.innerHTML = `<div class="meta">Sem informa√ß√µes de tabela.</div>`;
    } else {
      blocos.innerHTML = secoes.map(sec=>{
        const linhas = (sec.linhas || []).map(r =>
          `<tr><td>${r.etapa}</td><td>${r.data}</td></tr>`
        ).join('');
        return `
          <h2 style="margin:18px 0 10px">${sec.titulo}</h2>
          <table class="table">${linhas}</table>
        `;
      }).join('');
    }

    const linkDiv = document.getElementById('linkOficial');
    if(item.link_banca){
      linkDiv.innerHTML =
        `üîó <strong>Link para o site oficial:</strong> ` +
        `<a href="${item.link_banca}" target="_blank" rel="noopener">` +
        `${new URL(item.link_banca).hostname}</a>`;
    } else {
      linkDiv.textContent = '';
    }
  }
  main().catch(console.error);
  </script>
</body>
</html>
