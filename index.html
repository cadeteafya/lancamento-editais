<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lan√ßamento de editais</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <div class="container">
    <div class="hero-compact">
      <h1>√öltimos lan√ßamentos de editais em resid√™ncia m√©dica:</h1>
    </div>
  
    <div id="grid" class="grid cards-compact"></div>
  
    <nav id="pager" class="pager-compact" aria-label="Pagina√ß√£o"></nav>
  </div>

<script>
(async function () {
  // ============== CONFIG ==============
  const PAGE_SIZE = 9;                                // 3x3
  const COLORS = ["c-rose","c-blue","c-lilac","c-green"]; // classes de borda

  // ============== CARDS (3) ==============
  function cardHTML(item, idx){
    const c = COLORS[idx % COLORS.length];
    const url = `edital.html?slug=${encodeURIComponent(item.slug)}`;
    return `
      <a class="card ${c}" href="${url}" aria-label="Ver detalhes de ${item.nome}">
        <h2 class="title">${item.nome}</h2>
        <span class="micro">ver detalhes</span>
        <span class="icon" aria-hidden="true">üîé</span>
      </a>
    `;
  }

  // ============== PAGINA√á√ÉO (4) ==============
  function renderPager({page, totalPages}){
    const p = document.getElementById('pager');
    const btn = (label, go, isActive=false, disabled=false, cls='pg') =>
      `<a class="${cls} ${isActive?'active':''}"
          href="?page=${go}"
          ${disabled?'aria-disabled="true" tabindex="-1"':''}>${label}</a>`;

    const prev = btn('‚Äπ', Math.max(1, page-1), false, page===1, 'pg-nav');
    const next = btn('‚Ä∫', Math.min(totalPages, page+1), false, page===totalPages, 'pg-nav');

    // mostra no m√°ximo 5 p√°ginas vis√≠veis
    const vis = 5;
    let start = Math.max(1, page - Math.floor(vis/2));
    let end = Math.min(totalPages, start + vis - 1);
    if (end - start + 1 < vis) start = Math.max(1, end - vis + 1);

    let nums = '';
    for (let i = start; i <= end; i++) nums += btn(String(i), i, i===page);

    p.innerHTML = `${prev}${nums}${next}`;
  }

  // ============== BOOT ==============
  const grid = document.getElementById('grid');
  const params = new URLSearchParams(location.search);
  const page = Math.max(1, parseInt(params.get('page') || '1', 10));

  // carrega seus dados
  const data = await (await fetch('data/editais.json', {cache:'no-store'})).json();

  // ordena por captured_at desc se existir; sen√£o mant√©m ordem
  const sorted = [...data].sort((a,b) => String(b.captured_at || '').localeCompare(String(a.captured_at || '')));

  const totalPages = Math.max(1, Math.ceil(sorted.length / PAGE_SIZE));
  const start = (page - 1) * PAGE_SIZE;
  const pageItems = sorted.slice(start, start + PAGE_SIZE);

  grid.innerHTML = pageItems.map((item, i) => cardHTML(item, start + i)).join('');
  renderPager({page, totalPages});
})();
</script>

</body>
</html>


