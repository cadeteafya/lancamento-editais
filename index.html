<!doctype html><html lang="pt-br"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lançamento de editais</title>
<link rel="stylesheet" href="assets/style.css">
</head><body>
<div class="container">
  <div class="header"><h1>Últimos lançamentos</h1></div>
  <div id="grid" class="grid"></div>
</div>
<script>
async function main(){
  const res = await fetch('data/editais.json',{cache:'no-store'});
  const data = await res.json();

  // 1) ORDENAR: mais recentes primeiro
  const sorted = [...data].sort((a,b)=>{
    const da = (a.posted_at || a.captured_at || '');
    const db = (b.posted_at || b.captured_at || '');
    // ISO strings comparam certo com localeCompare
    const cmp = db.localeCompare(da);
    if (cmp !== 0) return cmp;
    // desempate estável
    return (b.slug || '').localeCompare(a.slug || '');
  });

  // 2) PAGINAÇÃO 3x3
  const pageSize = 9;
  const params = new URLSearchParams(location.search);
  let page = parseInt(params.get('page') || '1', 10);
  if (isNaN(page) || page < 1) page = 1;

  const total = sorted.length;
  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  if (page > totalPages) page = totalPages;

  const start = (page - 1) * pageSize;
  const end   = start + pageSize;
  const slice = sorted.slice(start, end);

  const grid = document.getElementById('grid');
  if(!slice.length){
    grid.innerHTML = `<div class="meta">Nenhum lançamento encontrado.</div>`;
    renderPager(totalPages, page);
    return;
  }

  grid.innerHTML = slice.map(x=>{
    const titulo = (x.instituicao && x.instituicao.trim()) || x.nome;
    return `
      <div class="card">
        <div class="p">
          <div class="badge">Lançamento de edital</div>
          <h3 style="margin-top:8px">${titulo}</h3>
          <a class="btn" href="edital.html?slug=${encodeURIComponent(x.slug)}">Ver detalhes</a>
        </div>
      </div>`;
  }).join('');

  renderPager(totalPages, page);
}

function renderPager(totalPages, current){
  const containerId = 'pager';
  let pager = document.getElementById(containerId);
  if (!pager) {
    pager = document.createElement('div');
    pager.id = containerId;
    pager.className = 'pager';
    document.querySelector('.container').appendChild(pager);
  }
  const link = (p, label, disabled=false, active=false) => {
    if (disabled) return `<span class="pg disabled">${label}</span>`;
    if (active)   return `<span class="pg active">${label}</span>`;
    const url = new URL(location.href);
    url.searchParams.set('page', p);
    return `<a class="pg" href="${url.pathname}${url.search}">${label}</a>`;
  };

  const parts = [];
  parts.push(link(Math.max(1,current-1),'‹', current===1));
  const span = 3;
  let s = Math.max(1, current-span), e = Math.min(totalPages, current+span);
  if (current <= span) e = Math.min(totalPages, 1+2*span);
  if (current + span > totalPages) s = Math.max(1, totalPages-2*span);
  for (let p=s; p<=e; p++) parts.push(link(p, String(p), false, p===current));
  parts.push(link(Math.min(totalPages,current+1),'›', current===totalPages));
  pager.innerHTML = parts.join('');
}

main().catch(err=>{
  console.error(err);
  document.getElementById('grid').innerHTML = `<div class="meta">Erro ao carregar dados.</div>`;
});
</script>

</body></html>



