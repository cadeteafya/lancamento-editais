<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lançamento de editais</title>
  <!-- Mantém os estilos no arquivo que você já tem -->
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <div class="container">
    <!-- Faixa do topo centralizada -->
    <div class="hero">Últimos lançamentos de editais em residência médica:</div>

    <!-- Grade 3×3 -->
    <div id="grid" class="grid"></div>

    <!-- Paginação -->
    <nav id="pager" class="pager" aria-label="Paginação"></nav>
  </div>

  <script>
  (async function () {
    // ====== CONFIG ======
    const PAGE_SIZE = 9; // 3 x 3
    // Variações suaves de borda dos cards (definidas no style.css)
    const COLOR_CLASSES = ['c-pink','c-blue','c-purple','c-green'];

    // ====== HELPERS ======
    function getTitulo(item){
      // Apenas o nome curto da instituição no card
      return (item.instituicao || item.display_title || item.nome || '').trim();
    }

    function renderCard(item, idx){
      const color = COLOR_CLASSES[idx % COLOR_CLASSES.length];
      const href  = `edital.html?slug=${encodeURIComponent(item.slug)}`;
      const titulo = getTitulo(item);

      return `
        <a class="card card-min ${color}" href="${href}" aria-label="Ver detalhes de ${titulo}">
          <div class="title">${titulo}</div>
          <div class="cta">ver detalhes</div>
        </a>
      `;
    }

    function renderPager({ page, totalPages }){
      const p = document.getElementById('pager');
      const btn = (label, go, active=false, disabled=false, cls='pg') => `
        <a class="${cls} ${active ? 'active' : ''}" href="?page=${go}"
           ${disabled ? 'aria-disabled="true" tabindex="-1"' : ''}>${label}</a>`;

      const prev = btn('‹', Math.max(1, page-1), false, page===1, 'pg');
      const next = btn('›', Math.min(totalPages, page+1), false, page===totalPages, 'pg');

      // Mostrar no máx. 5 páginas visíveis
      const VIS = 5;
      let start = Math.max(1, page - Math.floor(VIS/2));
      let end   = Math.min(totalPages, start + VIS - 1);
      if (end - start + 1 < VIS) start = Math.max(1, end - VIS + 1);

      let nums = '';
      for (let i = start; i <= end; i++){
        nums += btn(String(i), i, i === page);
      }
      p.innerHTML = `${prev}${nums}${next}`;
    }

    // ====== BOOT ======
    const grid   = document.getElementById('grid');
    const params = new URLSearchParams(location.search);
    const page   = Math.max(1, parseInt(params.get('page') || '1', 10));

    // Carrega dados
    const data = await (await fetch('data/editais.json', { cache: 'no-store' })).json();

    // Ordena pelos mais recentes (se tiver captured_at)
    const sorted = [...data].sort((a, b) => {
      const A = String(a.captured_at || '');
      const B = String(b.captured_at || '');
      // Desc: mais novo primeiro
      return B.localeCompare(A);
    });

    const totalPages = Math.max(1, Math.ceil(sorted.length / PAGE_SIZE));
    const start = (page - 1) * PAGE_SIZE;
    const pageItems = sorted.slice(start, start + PAGE_SIZE);

    grid.innerHTML = pageItems.map((item, i) => renderCard(item, start + i)).join('');
    renderPager({ page, totalPages });
  })();
  </script>
</body>
</html>
