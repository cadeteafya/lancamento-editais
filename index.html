<!doctype html><html lang="pt-br"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lançamento de editais</title>
<link rel="stylesheet" href="assets/style.css">
</head><body>
<div class="container">
  <div class="hero">Últimos lançamentos de editais em residência médica:</div>
  <div id="grid" class="grid"></div>
</div>
<script>
async function main(){
  const res = await fetch('data/editais.json',{cache:'no-store'});
  const data = await res.json();

  // ORDEM: mais recentes (posted_at || captured_at)
  const sorted = [...data].sort((a,b)=>{
    const da = (a.posted_at || a.captured_at || '');
    const db = (b.posted_at || b.captured_at || '');
    const cmp = db.localeCompare(da);
    if (cmp !== 0) return cmp;
    return (b.slug || '').localeCompare(a.slug || '');
  });

  // Paginação 3x3 (9 por página)
  const pageSize = 9;
  const params = new URLSearchParams(location.search);
  let page = parseInt(params.get('page') || '1', 10);
  if (isNaN(page) || page < 1) page = 1;

  const total = sorted.length;
  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  if (page > totalPages) page = totalPages;

  const start = (page - 1) * pageSize;
  const end   = start + pageSize;
  const slice = sorted.slice(start, end);

  const grid = document.getElementById('grid');
  if (!slice.length) {
    grid.innerHTML = `<div class="meta">Nenhum lançamento encontrado.</div>`;
    renderPager(totalPages, page);
    return;
  }

  // Cards minimalistas
  grid.innerHTML = slice.map(x=>{
    const titulo = (x.instituicao && x.instituicao.trim()) || x.nome;
    const href = `edital.html?slug=${encodeURIComponent(x.slug)}`;
    return `
      <a class="card card-min card-min-link" href="${href}">
        <div class="title">${titulo}</div>
        <div class="cta">Ver detalhes</div>
      </a>`;
  }).join('');

  renderPager(totalPages, page);
}

function renderPager(totalPages, current){
  let pager = document.getElementById('pager');
  if (!pager) {
    pager = document.createElement('div');
    pager.id = 'pager';
    pager.className = 'pager';
    document.querySelector('.container').appendChild(pager);
  }

  const makeLink = (p, label, {disabled=false, active=false}={})=>{
    if (disabled) return `<span class="pg disabled">${label}</span>`;
    if (active)   return `<span class="pg active">${label}</span>`;
    const url = new URL(location.href);
    url.searchParams.set('page', p);
    return `<a class="pg" href="${url.pathname}?${url.searchParams.toString()}">${label}</a>`;
  };

  const parts = [];
  // seta esquerda
  parts.push(makeLink(Math.max(1,current-1), '‹', {disabled: current===1}));

  // janela com no máx. 5 páginas visíveis
  const maxWin = 5;
  if (totalPages <= maxWin) {
    for (let p=1; p<=totalPages; p++) parts.push(makeLink(p, String(p), {active:p===current}));
  } else {
    // tenta centralizar a página atual na janela
    let s = Math.max(1, current - Math.floor(maxWin/2));
    let e = s + maxWin - 1;
    if (e > totalPages) { e = totalPages; s = e - maxWin + 1; }

    for (let p=s; p<=e; p++) parts.push(makeLink(p, String(p), {active:p===current}));
  }

  // seta direita
  parts.push(makeLink(Math.min(totalPages,current+1), '›', {disabled: current===totalPages}));

  pager.innerHTML = parts.join('');
}

main().catch(err=>{
  console.error(err);
  document.getElementById('grid').innerHTML = `<div class="meta">Erro ao carregar dados.</div>`;
});
</script>

</body></html>





